# Campaign 管理 API（Staff）

Base Path：`/api/v{version}/tenants/{tenantId}/gaming/campaigns`

> 說明：以下為後台 Staff 使用之 Campaign 管理 API，皆需對應的 permission。

## Permissions

- `gaming.campaign.read`
- `gaming.campaign.create`
- `gaming.campaign.update`
- `gaming.campaign.activate`
- `gaming.campaign.end`
- `gaming.campaign.delete`
- `gaming.campaign.draw.manage`

## Endpoints

### 建立 Campaign

`POST /`

Permission：`gaming.campaign.create`

Request Body:

```json
{
  "gameCode": "string",
  "playTypeCode": "string",
  "name": "string",
  "grantOpenAtUtc": "2025-01-01T00:00:00Z",
  "grantCloseAtUtc": "2025-01-02T00:00:00Z"
}
```

Response:

- `200 OK` → `Guid`

---

### 取得 Campaign 列表（含 paging / filter）

`GET /?status={status}&gameCode={gameCode}&keyword={keyword}&page={page}&pageSize={pageSize}`

Permission：`gaming.campaign.read`

Query Params:

- `status`：`Draft` / `Active` / `Ended`（可選）
- `gameCode`：GameCode（可選）
- `keyword`：搜尋名稱（可選）
- `page`：頁碼（預設 1）
- `pageSize`：每頁筆數（預設 20）

Response:

- `200 OK` → `PagedResult<CampaignSummaryDto>`

---

### 取得 Campaign 詳細資料

`GET /{campaignId}`

Permission：`gaming.campaign.read`

Response:

- `200 OK` → `CampaignDetailDto`
- `404 Not Found`

---

### 更新 Campaign（僅 Draft）

`PUT /{campaignId}`

Permission：`gaming.campaign.update`

Request Body:

```json
{
  "name": "string",
  "grantOpenAtUtc": "2025-01-01T00:00:00Z",
  "grantCloseAtUtc": "2025-01-02T00:00:00Z"
}
```

Response:

- `200 OK`

---

### 啟用 Campaign

`POST /{campaignId}:activate`

Permission：`gaming.campaign.activate`

Response:

- `200 OK`

---

### 結束 Campaign

`POST /{campaignId}:end`

Permission：`gaming.campaign.end`

Response:

- `200 OK`

---

### 綁定 Draw

`POST /{campaignId}/draws`

Permission：`gaming.campaign.draw.manage`

Request Body:

```json
{
  "drawId": "00000000-0000-0000-0000-000000000000"
}
```

Response:

- `200 OK`

---

### 移除 Draw（僅 Draft）

`DELETE /{campaignId}/draws/{drawId}`

Permission：`gaming.campaign.draw.manage`

Response:

- `200 OK`

---

### 刪除 Campaign（僅 Draft）

`DELETE /{campaignId}`

Permission：`gaming.campaign.delete`

Response:

- `200 OK`

## DTO 摘要

### CampaignSummaryDto

```json
{
  "id": "guid",
  "name": "string",
  "status": "Draft|Active|Ended",
  "gameCode": "string",
  "playTypeCode": "string",
  "grantOpenAtUtc": "2025-01-01T00:00:00Z",
  "grantCloseAtUtc": "2025-01-02T00:00:00Z",
  "drawCount": 0,
  "createdAtUtc": "2025-01-01T00:00:00Z"
}
```

### CampaignDetailDto

```json
{
  "id": "guid",
  "name": "string",
  "status": "Draft|Active|Ended",
  "gameCode": "string",
  "playTypeCode": "string",
  "grantOpenAtUtc": "2025-01-01T00:00:00Z",
  "grantCloseAtUtc": "2025-01-02T00:00:00Z",
  "drawCount": 0,
  "createdAtUtc": "2025-01-01T00:00:00Z",
  "draws": [
    {
      "drawId": "guid",
      "createdAtUtc": "2025-01-01T00:00:00Z"
    }
  ]
}
```
