# DrawGroup 管理 API（Staff）

Base Path：`/api/v{version}/tenants/{tenantId}/gaming/draw-groups`

> 說明：以下為後台 Staff 使用之 DrawGroup 管理 API，皆需對應的 permission。
> 舊路徑 `/campaigns` 仍保留相容。

## Permissions

- `gaming.drawgroup.read`
- `gaming.drawgroup.create`
- `gaming.drawgroup.update`
- `gaming.drawgroup.activate`
- `gaming.drawgroup.end`
- `gaming.drawgroup.delete`
- `gaming.drawgroup.draw.manage`

> 舊代碼 `gaming.campaign.*` 仍可視為相容權限（短期相容）。

## Endpoints

### 建立 DrawGroup

`POST /`

Permission：`gaming.drawgroup.create`

Request Body:

```json
{
  "gameCode": "string",
  "playTypeCode": "string",
  "name": "string",
  "grantOpenAtUtc": "2025-01-01T00:00:00Z",
  "grantCloseAtUtc": "2025-01-02T00:00:00Z"
}
```

Response:

- `200 OK` → `Guid`

---

### 取得 DrawGroup 列表（含 paging / filter）

`GET /?status={status}&gameCode={gameCode}&keyword={keyword}&page={page}&pageSize={pageSize}`

Permission：`gaming.drawgroup.read`

Query Params:

- `status`：`Draft` / `Active` / `Ended`（可選）
- `gameCode`：GameCode（可選）
- `keyword`：搜尋名稱（可選）
- `page`：頁碼（預設 1）
- `pageSize`：每頁筆數（預設 20）

Response:

- `200 OK` → `PagedResult<DrawGroupSummaryDto>`

---

### 取得 DrawGroup 詳細資料

`GET /{drawGroupId}`

Permission：`gaming.drawgroup.read`

Response:

- `200 OK` → `DrawGroupDetailDto`
- `404 Not Found`

---

### 更新 DrawGroup（僅 Draft）

`PUT /{drawGroupId}`

Permission：`gaming.drawgroup.update`

Request Body:

```json
{
  "name": "string",
  "grantOpenAtUtc": "2025-01-01T00:00:00Z",
  "grantCloseAtUtc": "2025-01-02T00:00:00Z"
}
```

Response:

- `200 OK`

---

### 啟用 DrawGroup

`POST /{drawGroupId}:activate`

Permission：`gaming.drawgroup.activate`

Response:

- `200 OK`

---

### 結束 DrawGroup

`POST /{drawGroupId}:end`

Permission：`gaming.drawgroup.end`

Response:

- `200 OK`

---

### 綁定 Draw

`POST /{drawGroupId}/draws`

Permission：`gaming.drawgroup.draw.manage`

Request Body:

```json
{
  "drawId": "00000000-0000-0000-0000-000000000000"
}
```

Response:

- `200 OK`

---

### 移除 Draw（僅 Draft）

`DELETE /{drawGroupId}/draws/{drawId}`

Permission：`gaming.drawgroup.draw.manage`

Response:

- `200 OK`

---

### 刪除 DrawGroup（僅 Draft）

`DELETE /{drawGroupId}`

Permission：`gaming.drawgroup.delete`

Response:

- `200 OK`

## DTO 摘要

### DrawGroupSummaryDto

```json
{
  "id": "guid",
  "name": "string",
  "status": "Draft|Active|Ended",
  "gameCode": "string",
  "playTypeCode": "string",
  "grantOpenAtUtc": "2025-01-01T00:00:00Z",
  "grantCloseAtUtc": "2025-01-02T00:00:00Z",
  "drawCount": 0,
  "createdAtUtc": "2025-01-01T00:00:00Z"
}
```

### DrawGroupDetailDto

```json
{
  "id": "guid",
  "name": "string",
  "status": "Draft|Active|Ended",
  "gameCode": "string",
  "playTypeCode": "string",
  "grantOpenAtUtc": "2025-01-01T00:00:00Z",
  "grantCloseAtUtc": "2025-01-02T00:00:00Z",
  "drawCount": 0,
  "createdAtUtc": "2025-01-01T00:00:00Z",
  "draws": [
    {
      "drawId": "guid",
      "createdAtUtc": "2025-01-01T00:00:00Z"
    }
  ]
}
```
